# The Velvet Spine - BookStore ER Diagram

## Entity-Relationship Diagram Documentation

### Overview
This document represents the Entity-Relationship Diagram for The Velvet Spine BookStore application, showing the database structure and relationships between different entities.

---

## Entities and Attributes

### 1. User Entity
**Primary Key**: `_id` (ObjectId)

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| `_id` | ObjectId | Primary Key | Unique identifier |
| `username` | String | Required, Unique | User's username |
| `email` | String | Required, Unique | User's email address |
| `password` | String | Required | Hashed password |
| `address` | String | Required | User's delivery address |
| `avatar` | String | Optional | Profile picture URL |
| `role` | String | Default: "user" | User role (user/admin) |
| `favourites` | Array | References Book | User's favorite books |
| `cart` | Array | References Book | User's shopping cart items |
| `orders` | Array | References Order | User's order history |
| `createdAt` | Date | Auto | Account creation timestamp |
| `updatedAt` | Date | Auto | Last update timestamp |

### 2. Book Entity
**Primary Key**: `_id` (ObjectId)

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| `_id` | ObjectId | Primary Key | Unique identifier |
| `url` | String | Required | Book cover image URL |
| `title` | String | Required | Book title |
| `author` | String | Required | Book author |
| `price` | Number | Required | Book price |
| `desc` | String | Required | Book description |
| `language` | String | Required | Book language |
| `createdAt` | Date | Auto | Book added timestamp |
| `updatedAt` | Date | Auto | Last update timestamp |

### 3. Order Entity
**Primary Key**: `_id` (ObjectId)

| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| `_id` | ObjectId | Primary Key | Unique identifier |
| `user` | ObjectId | Required, FK | References User |
| `book` | ObjectId | Required, FK | References Book |
| `status` | String | Default: "Order Placed" | Order status |
| `createdAt` | Date | Auto | Order placed timestamp |
| `updatedAt` | Date | Auto | Last update timestamp |

---

## Relationships

### 1. User - Book (Many-to-Many via Favourites)
- **Relationship**: Many Users can favorite Many Books
- **Implementation**: User's `favourites` array contains Book ObjectIds
- **Cardinality**: M:N
- **Description**: Users can add multiple books to their favorites list

### 2. User - Book (Many-to-Many via Cart)
- **Relationship**: Many Users can add Many Books to Cart
- **Implementation**: User's `cart` array contains Book ObjectIds
- **Cardinality**: M:N
- **Description**: Users can add multiple books to their shopping cart

### 3. User - Order (One-to-Many)
- **Relationship**: One User can have Many Orders
- **Implementation**: Order's `user` field references User
- **Cardinality**: 1:N
- **Description**: Each order belongs to one user, users can have multiple orders

### 4. Book - Order (One-to-Many)
- **Relationship**: One Book can be in Many Orders
- **Implementation**: Order's `book` field references Book
- **Cardinality**: 1:N
- **Description**: Each order contains one book, same book can be ordered multiple times

---

## Relationship Cardinality Matrix

| Entity | User | Book | Order |
|--------|------|------|-------|
| **User** | - | M:N (Favourites)<br>M:N (Cart) | 1:N |
| **Book** | M:N (Favourites)<br>M:N (Cart) | - | 1:N |
| **Order** | 1:N | 1:N | - |

---

## ER Diagram (Text Representation)

```
        User (1:N) ──────────────── Order (1:N) ──────────────── Book
           │                           │                           │
           │                           │                           │
           │ (M:N Favourites)         │                           │
           │                           │                           │
           └──────────────────────────┼───────────────────────────┘
                    │                 │
                    │ (M:N Cart)      │
                    │                 │
                    └─────────────────┘
```

### Legend:
- **Entities**: User, Book, Order
- **Relationships**:
  - Solid lines: Direct relationships
  - Dashed lines: Many-to-Many relationships
  - Numbers: Cardinality (1:N = One-to-Many, M:N = Many-to-Many)

---

## Database Design Notes

### Primary Keys
- All entities use MongoDB ObjectId as primary key
- Auto-generated by MongoDB/Mongoose

### Foreign Keys
- `Order.user` → `User._id`
- `Order.book` → `Book._id`
- Array references in User model for favourites and cart

### Constraints
- **User.username**: Must be unique across all users
- **User.email**: Must be unique across all users
- **User.role**: Restricted to "user" or "admin" values
- **Order.status**: Restricted to predefined status values

### Indexes (Recommended)
- Unique index on `User.username`
- Unique index on `User.email`
- Index on `User.role` for admin queries
- Index on `Order.status` for status filtering
- Index on `Order.user` for user order history

### Data Integrity
- **Referential Integrity**: MongoDB handles through ObjectId references
- **Cascade Operations**: Not automatically handled (application logic required)
- **Data Validation**: Mongoose schema validation on required fields

---

## Usage Examples

### Querying User's Orders
```javascript
// Get all orders for a specific user
const userOrders = await Order.find({ user: userId })
  .populate('book')
  .sort({ createdAt: -1 });
```

### Finding User's Favorites
```javascript
// Get user's favorite books
const userFavorites = await User.findById(userId)
  .populate('favourites')
  .select('favourites');
```

### Order Status Management
```javascript
// Update order status
await Order.findByIdAndUpdate(orderId, {
  status: 'Out for delivery'
});
```

---

## File Location
This ER Diagram documentation is stored in: `BookStore_ER_Diagram.md`

For visual ER diagram tools, consider using:
- Lucidchart
- Draw.io
- MySQL Workbench
- MongoDB Compass Schema Analysis
